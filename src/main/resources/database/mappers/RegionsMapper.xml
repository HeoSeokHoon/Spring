<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <!-- mapper namespace(중복불가)는 비우면 에러 -->
  <!-- 해당 mapper를 사용할 DAO의 풀패키지명으로 작성 : 중복방지 -->
  <mapper namespace="com.winter.app.regions.RegionDAO">
  		
 	<!-- Config 파일에 Alias 등록 후 Type을 줄여서 가능 com.winter.app.regions.RegionDTO > RegionDTO -->
  	
  	<sql id="search3">
  		WHERE
  		<choose>
  			<when test="kind=='kind1">
  				TITLE LIKE '%'||#{search}||'%'	
  			</when>
  			<when test="kind=='kind2'">
  				CONTENTS LIKE '%'||#{search}||'%'
  			</when>
  			<otherwise>
  				WRITER LIKE '%'||#{search}||'%'		
  			</otherwise>
  		</choose>
  	</sql>
  		
  	<sql id="search2">
  		<where>
	  		<if test="kind=='kind1' or kind=='kind4'">
				TITLE LIKE '%'||#{search}||'%'
	  		</if>
	  		<if test="kind=='kind2' or kind=='kind4'">
	  			OR CONTENTS LIKE '%'||#{search}||'%'
	  		</if>
	  		<if test="kind=='kind3' or kind=='kind4'">
	  			OR WRITER LIKE '%'||#{search}||'%'
	  		</if>  		
  		</where>
  	</sql>
  	
  	<sql id="search">
  		<!-- TITLE, CONTENTS, WRITER 컬럼 있다고 가정하고 -->
  		WHERE REGION_NAME LIKE '%'||#{search}||'%'
  	</sql>
  	
  	<!-- Delete -->
  	<delete id="delete" parameterType="RegionDTO">
  		DELETE REGIONS WHERE REGION_ID=#{region_id}
  	</delete>
  	
  	<!-- Update -->
  	<update id="update" parameterType="RegionDTO">
  		UPDATE REGIONS SET REGION_NAME=#{region_name} WHERE REGION_ID=#{region_id}
  	</update>
  	
  	<!-- Insert -->
  	<insert id="add" parameterType="RegionDTO">
  		INSERT INTO REGIONS VALUES (REGIONS_SEQ.NEXTVAL,#{region_name})
  	</insert>
  	
  	<!-- detail -->
  	<!-- id값은 DAO의 메서드명 -->
  	<select id="getDetail" resultType="RegionDTO" parameterType="RegionDTO">
  		SELECT * FROM REGIONS WHERE REGION_ID=#{region_id}
  	</select>
  	
  	<!-- getTotal -->
  	<select id="getTotal" resultType="Long" parameterType="Pager">
  		SELECT COUNT(REGION_ID) FROM REGIONS
  		<include refid="search"></include>
  	</select>
  	
  	<!-- list -->
  	<select id="getList" resultType="RegionDTO" parameterType="Pager">
  		SELECT * FROM 
			(SELECT ROWNUM R, RG.* FROM 
				(SELECT * FROM REGIONS
				<include refid="search"></include>
				ORDER BY REGION_ID DESC)
			RG)
		WHERE R BETWEEN #{startRow} AND #{lastRow}
  	</select>
  </mapper>